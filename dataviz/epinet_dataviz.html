<style type="text/css">line {
	stroke: black;
	opacity: .5;
	stroke-width: 2px;
}

circle {
	fill: lightgray;
	stroke: black;
	stroke-width: 2px;
}

.node text {
	font-size: 15px;
	text-anchor: middle;
	font-weight: bold;
	font-family: Quicksand;
}

#tooltip {
	position: absolute;
	width: 250px;
	height: auto;
	padding: 10px;
	background-color: white;
	-webkit-border-radius: 10px;
	-moz-border-radius: 10px;
	border-radius: 10px;
	-webkit-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
	-moz-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
	box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
	pointer-events: none;
	color: black;
}

#tooltip.hidden {
	display: none;
}

#tooltip p {
	margin: 0.5;
	font-family: Quicksand;
	font-size: 16px;
	line-height: 20px;
}

#tooltip_id {
	font-size: 20px;
}

#tooltip_desc {
	font-size: 14px;
}
</style>
<div class="hidden" id="tooltip">
<div id="tooltip_id">
</div>
<hr />

<p>Thematic areas:</p>
<div id="tooltip_thematic_areas">
</div>
<hr />

<div id="tooltip_desc">

</div>
<hr />


</div>
<link href="https://fonts.googleapis.com/css?family=Quicksand" rel="stylesheet" /><svg height="600" width="1024"></svg>
<p>&nbsp;</p>

<p><script src="https://d3js.org/d3.v4.min.js"></script><script src="http://d3js.org/queue.v1.min.js"></script><script>


function getBaseURL() {
    var url = location.href;  // entire url including querystring - also: window.location.href;
    var baseURL = url.substring(0, url.indexOf('/', 14));


    if (baseURL.indexOf('http://localhost') != -1) {
        // Base Url for localhost
        var url = location.href;  // window.location.href;
        var pathname = location.pathname;  // window.location.pathname;
        var index1 = url.indexOf(pathname);
        var index2 = url.indexOf("/", index1 + 1);
        var baseLocalUrl = url.substr(0, index2);

        return baseLocalUrl + "/";
    }
    else {
        // Root Url for domain name
        return baseURL + "/";
    }

}

var nodes_url = "https://api.myjson.com/bins/ua9fr";
var discursive_nodes_url = "https://api.myjson.com/bins/10u13b";
var edges_url = "https://api.myjson.com/bins/7nsg7";


/*var nodes_url = getBaseURL() + "/api/concepts/nodes";
var discursive_nodes_url = getBaseURL() + "/api/concepts/discursive_nodes";
var edges_url = getBaseURL() + "api/discursive-relationships/edges";*/


var marker = d3.select("svg").append('defs')
.append('marker')
.attr("id", "Triangle")
.attr("refX", 20)
.attr("refY", 6)
.attr("markerUnits", 'userSpaceOnUse')
.attr("markerWidth", 12)
.attr("markerHeight", 18)
.attr("orient", 'auto')
.append('path')
.attr("d", 'M 0 0 12 6 0 12 3 6');


var svg = d3.select("svg"),
    width = +svg.attr("width"),
    height = +svg.attr("height");
    

var color = d3.scaleOrdinal(d3.schemeCategory20);

var simulation = d3.forceSimulation()
    .force("link", d3.forceLink().id(function(d) { return d.id; }))
    .force("charge", d3.forceManyBody().strength(-1500).theta(0.2).distanceMin(95).distanceMax(200))
    .force("center", d3.forceCenter(width / 2, height / 2));
    
    
queue()
.defer(d3.json, nodes_url)
.defer(d3.json, discursive_nodes_url)
.defer(d3.json, edges_url)
.await(function(error, file1, file2, file3) {createForceLayout(file1, file2, file3); });

function createForceLayout (nodes, discursive_nodes, links) {
	
  //Draw links	
  var link = svg.append("g")
    .attr("class", "links")
    .selectAll("line")
    .data(links)
    .enter().append("line");
  
  //Draw groups for nodes
  var node = svg.append("g")
    .attr("class", "nodes")
    .selectAll("concepts")
    .data(nodes.concat(discursive_nodes))
    .enter()
    .append("g")
    .attr("class", "node");
  
  //Draw circles
  var circles = node.append("circle")
  .attr("r", 10)
  //.style("fill", function(d){ return d.type = "excerpt" ? 'lightgray' : 'green' });
  .call(d3.drag()
    .on("start", dragstarted)
    .on("drag", dragged)
    .on("end", dragended));
    
  //Add onclick url to circles
  node.selectAll("circle").on("click", function(d) { window.open(getBaseURL() + d.url); });
    
  //Draw titles
  var titles = node.append("title")
  .text(function(d) {
    return d.id + " - click for +info";
  });
  
  //Draw node text
  var text = node.append("text")
  .attr("y", 25)
  .text(function(d) {
    return d.id
  });

  //Draw markers  
  d3.selectAll("line").attr("marker-end", "url(#Triangle)");
  
  //Events to display extra information on html
  svg.selectAll(".node")
  .on("mouseover", function(d,i) {
	  	var d = this.__data__;
	  	
	  	//Unhide class and update elements
	  	d3.select("#tooltip").classed("hidden", false);

	  	d3.select("#tooltip_id")
		.text(d.id);
   
		d3.select("#tooltip_thematic_areas")
		.text(d.thematic_areas);
		
		d3.select("#tooltip_desc")
		.text(d.desc);
      });

  simulation
      .nodes(nodes.concat(discursive_nodes))
      .on("tick", ticked);

  simulation.force("link")
      .links(links);

  function ticked() {
	    link
	      .attr("x1", function(d) {
	        return d.source.x;
	      })
	      .attr("y1", function(d) {
	        return d.source.y;
	      })
	      .attr("x2", function(d) {
	        return d.target.x;
	      })
	      .attr("y2", function(d) {
	        return d.target.y;
	      });

	    node.attr("transform", function(d) {
	      return "translate(" + d.x + "," + d.y + ")";
	    })
	  }
  
}

function dragstarted(d) {
  if (!d3.event.active) simulation.alphaTarget(0.3).restart();
  d.fx = d.x;
  d.fy = d.y;
}

function dragged(d) {
  d.fx = d3.event.x;
  d.fy = d3.event.y;
}

function dragended(d) {
  if (!d3.event.active) simulation.alphaTarget(0);
  d.fx = null;
  d.fy = null;
}

</script></p>

<p>&nbsp;</p>

<blockquote>
<hr />
<h2 class="text-align-justify">At present there exists a great diversity for assessing the impacts of science and technology on society and the environment. This project explores new ways for bringing more of these methodologies into concert with each other, as well as with the concerns of innovators, policy makers and citizens. EPINET introduces the concept of epistemic networks as a way of conceptualizing complex developments within emerging fields of sociotechnical innovation. It establishes a weak or "soft" framework within which the plurality of different assessment practices can be explored in a concerted and holistic manner</h2>
</blockquote>